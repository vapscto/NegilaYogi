

<section class="content">
    <form class="form-horizontal ng-pristine ng-valid" role="form" name="myform" data-ng-init="getloaddata()" novalidate>
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Percentage Wise Attendance Report </h3>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                </div>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="text-center well" ng-init="type23='All'">
                            <label class="radio-inline">
                                <input type="radio" ng-model="type23" value="All" name="aldl" ng-change="getDataByType(type23);">
                                <span class="lbl padding-8">All</span>
                            </label>
                            <label class="radio-inline">
                                <input type="radio" ng-model="type23" value="Indi" name="aldl" ng-change="getDataByType(type23);">
                                <span class="lbl padding-8">Individual</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-sm-4">Academic Year:<strong style="color:red;">*</strong></label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="sel1" data-ng-model="ASMAY_Id" name="cat" required ng-change="getclass(ASMAY_Id)">
                                        <option value="">--Select--</option>
                                        <option ng-repeat="option in yearlist" value="{{option.asmaY_Id}}" ng-selected="{{option.Selected===true}}">{{option.asmaY_Year}}</option>
                                    </select>
                                    <div class="error-messages" ng-if="interacted(myform.cat)" ng-messages="myform.cat.$error">
                                        <div ng-message="required">Select Academic Year</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-sm-4">Class:<strong style="color:red;">*</strong></label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="sel1" data-ng-model="ASMCL_Id" ng-change="getsection(asmaY_Id,asmcL_Id)" name="cat1"
                                            required>
                                        <option value="">--Select--</option>
                                        <option ng-repeat="option in classlist" value="{{option.asmcL_Id}}" ng-selected="{{option.Selected===true}}">{{option.asmcL_ClassName}}</option>
                                    </select>
                                    <div class="error-messages" ng-if="interacted(myform.cat1)" ng-messages="myform.cat1.$error">
                                        <div ng-message="required">Select Class</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-sm-4">Section:<strong style="color:red;">*</strong></label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="sel1" data-ng-model="ASMS_Id" name="cat2" ng-required="type23!='All'" ng-disabled="type23=='All'">
                                        <option value="">--Select--</option>
                                        <option value="0">All</option>
                                        <option ng-repeat="option in sectionlist" value="{{option.asmS_Id}}" ng-selected="{{option.Selected===true}}">{{option.asmC_SectionName}}</option>
                                    </select>
                                    <div class="error-messages" ng-if="interacted(myform.cat2)" ng-messages="myform.cat2.$error">
                                        <div ng-message="required">Select Section</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-sm-4">
                                    From Date:<strong style="color:red;display:inline; font-weight: bolder; margin-left: 1px;">
                                        *
                                    </strong>
                                </label>
                                <div class="col-sm-8">
                                    <md-datepicker ng-model="obj.fromdate" onkeydown="return false" name="from_date" id="FromDate" ng-change='setTodate(obj)'
                                                   md-min-date="minDatef" md-max-date="maxDatef" md-placeholder="Enter date" required>
                                    </md-datepicker>
                                    <div class="error-messages" ng-if="interacted(myform.from_date)" ng-messages="myform.from_date.$error">
                                        <div ng-message="required" style="color:red">Select From Date</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-sm-4">
                                    Percentage Conditon :
                                    <strong style="color:red;display:inline; font-weight: bolder; margin-left: 1px;">*</strong>
                                </label>
                                <div class="col-sm-4">
                                    <select class="form-control" id="dsfs" data-ng-model="flag" name="catddd2" required>
                                        <option value="">--Select--</option>
                                        <option ng-repeat="doption in percentagearray" value="{{doption.id}}" ng-selected="{{option.Selected===true}}">
                                            {{doption.value}}
                                        </option>
                                    </select>
                                    <div class="error-messages" ng-if="interacted(myform.catddd2)" ng-messages="myform.catddd2.$error">
                                        <div ng-message="required">Select Percentage Conditon</div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <input class="form-control" name="fname" ng-model="percentage" id="usr" type="text" allow-pattern="(\s|[0-9.><=])"
                                           maxlength="20" placeholder="Percentage" required>
                                    <div class="error-messages" ng-if="interacted(myform.fname)" ng-messages="myform.fname.$error">
                                        <div ng-message="required">Enter Percentage</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-sm-4">To Date:<strong style="color:red;display:inline; font-weight: bolder; margin-left: 1px;">*</strong></label>
                                <div class="col-sm-8">
                                    <md-datepicker ng-model="obj.todate" onkeydown="return false" ng-change='setTodate1(obj)' name="to_date" id="todate"
                                                   md-min-date="minDatet" md-max-date="maxDatet" md-placeholder="Enter date" required>
                                    </md-datepicker>
                                    <div class="error-messages" ng-if="interacted(myform.to_date)" ng-messages="myform.to_date.$error">
                                        <div ng-message="required" style="color:red">Select To Date</div>
                                    </div>
                                </div>
                                <span style="color:red;">{{errMessage}}</span>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <div class="text-center">
                                <md-button type="button" class="md-raised md-primary" ng-disabled="form.$invalid" ng-click="showreport(obj)" id="save-btn" aria-disabled="false">
                                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    Report
                                </md-button>
                                <md-button type="button" class="md-raised md-warn" data-ng-click="clear()">
                                    <i class="fa fa-times" aria-hidden="true"></i>
                                    Cancel
                                </md-button>
                                <md-button type="submit" ng-click="exportToExcel('#printSectionIdecel')" target="_blank" class="md-raised md-primary"
                                           ng-disabled="export_flag">
                                    <i class="fa fa-file-excel-o" aria-hidden="true"></i>
                                    Export
                                </md-button>
                                <md-button type="submit" ng-click="printData()" target="_blank" class="md-raised md-primary" ng-disabled="export_flag">
                                    <i class="fa fa-print" aria-hidden="true"></i>
                                    print
                                </md-button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </form>

    <div class="box box-primary" ng-show="report">
        <div class="box-header with-border">
            <h3 class="box-title">Percentage Wise Attendance Report</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
            </div>
        </div>
        <div class="box-body">
            <div class="col-sm-4 pull-right">
                <div class="form-group searchbox">
                    <div class="input-group">
                        <input class="form-control" ng-model="searchValue" type="text" placeholder="search here...">
                        <span class="input-group-addon">
                            <button class="btn" type="submit" ng-click="searchByColumn(searchValue,searchColumn)"><i class="fa fa-search"></i></button>
                        </span>
                    </div>
                </div>
            </div>
            <br />
            <div class="row">
                <div class="col-sm-12">
                    <table class="table table-hover table-responsive table-bordered" id="table1">
                        <thead>
                            <tr>
                                <th class="hdTH">
                                    <label>
                                        <input type="checkbox" value="" ng-model="all2" ng-click="toggleAll()">
                                        <span class="lbl padding-8"></span>
                                    </label>
                                </th>
                                <th><a href="" ng-click="sortBy('sno')">SL.No.</a></th>
                                <th><a href="" ng-click="sortBy('studentname')">Student Name</a></th>
                                <th><a href="" ng-click="sortBy('AMST_AdmNo')">Adm.No</a></th>
                                <th><a href="" ng-click="sortBy('rollno')">Roll No</a></th>
                                <th><a href="" ng-click="sortBy('classname')">Class</a></th>
                                <th><a href="" ng-click="sortBy('sectionname')">Section</a></th>
                                <th><a href="" ng-click="sortBy('totalworkingdays')">Total Working Days</a></th>
                                <th><a href="" ng-click="sortBy('totalpresentdays')">Total Present Days</a></th>
                                <th><a href="" ng-click="sortBy('percentage')">Percentage</a></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr dir-paginate="user in filterValue = (reportdetails | filter : searchValue)| orderBy:propertyName:reverse|itemsPerPage:itemsPerPage" current-page="currentPage" ng-class-odd="'odd'">
                                <td class="text-center  hdTD">
                                    <label>
                                        <input type="checkbox" ng-model="user.selected" value="{{user.AMST_Id}}" ng-change="optionToggled(user)">
                                        <span class="lbl padding-8"></span>
                                    </label>
                                </td>
                                <td>{{ itemsPerPage*(currentPage-1)+$index+1}}</td>
                                <td class="text-left padding-left-5">{{ user.studentname}}</td>
                                <td class="text-left padding-left-5">{{ user.AMST_AdmNo}}</td>
                                <td class="text-center">{{ user.rollno}}</td>
                                <td class="text-left padding-left-5">{{ user.classname}}</td>
                                <td class="text-left padding-left-5">{{ user.sectionname}}</td>
                                <td class="text-center">{{ user.totalworkingdays}}</td>
                                <td class="text-center">{{ user.totalpresentdays}}</td>
                                <td class="text-center">{{ user.percentage}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <dir-pagination-controls max-size="5" direction-links="true" boundary-links="true" on-page-change="pageChanged(newPageNumber)">
                    </dir-pagination-controls>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <div class="well text-center">
                        <div class="checkbox-inline">
                            <label><input type="checkbox" data-ng-model="obj.smschecked" value="1"><span class="lbl padding-8">SMS</span></label>
                        </div>
                        <div class="checkbox-inline">
                            <label><input type="checkbox" data-ng-model="obj.emailchecked" value="1"><span class="lbl padding-8">EMAIL</span></label>
                        </div>
                        <div class="checkbox-inline">
                            <label><input type="checkbox" data-ng-model="obj.whatsappchecked" value="1"><span class="lbl padding-8">WhatsApp</span></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="text-center">
                        <md-button type="button" class="md-raised md-primary" ng-click="saveUseronce()"
                                   ng-disabled="obj.smschecked==false && obj.emailchecked==false && obj.whatsappchecked==false">
                            <i class="fa fa-check-square-o" aria-hidden="true"></i> SEND
                        </md-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div id="printSectionId" ng-show="table_flag">
    <div class="baldwin text-center">
        <img src="{{imgname}}" class="img-responsive" alt="baldwin">
    </div>
    <center><h4>Attendance Percentage Wise Report</h4></center>
    <center><h4>{{reportdetailsdd}}</h4></center>
    <br />
    <table class="table-bordered" id="table">
        <thead>
            <tr>
                <th>SL.No.</th>
                <th>Student Name</th>
                <th>Adm.No</th>
                <th>Roll No</th>
                <th>Class</th>
                <th>Section</th>
                <th>Total Working Days</th>
                <th>Total Present Days</th>
                <th>Percentage</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="user in printdatatable | filter : searchValue">
                <td class="text-center">{{$index+1}}</td>
                <td class="text-left padding-left-5">{{ user.studentname}}</td>
                <td class="text-left padding-left-5">{{ user.AMST_AdmNo}}</td>
                <td class="text-center">{{ user.rollno}}</td>
                <td class="text-left padding-left-5">{{ user.classname}}</td>
                <td class="text-left padding-left-5">{{ user.sectionname}}</td>
                <td class="text-center">{{ user.totalworkingdays}}</td>
                <td class="text-center">{{ user.totalpresentdays}}</td>
                <td class="text-center">{{ user.percentage}}</td>
            </tr>
        </tbody>
    </table>
</div>

<div id="printSectionIdecel" ng-show="table_flag">
    <table>
        <tr style="border : 0.5px black solid">
            <td colspan="9" style="text-align:center"><b>{{inst_name}} </b></td>
        </tr>
        <tr style="border : 0.5px black solid">
            <td colspan="9" style="text-align:center"><b> {{inst_address}}</b></td>
        </tr>
        <tr style="border : 0.5px black solid">
            <td colspan="9" style="text-align:center"><b>Attendance Percentage Wise Report </b></td>
        </tr>
        <tr style="border : 0.5px black solid">
            <td colspan="9" style="text-align:center"><b>{{reportdetailsdd}}</b></td>
        </tr>
        <tr style="border : 0.5px black solid">
            <td colspan="9" style="text-align:center">&nbsp;</td>
        </tr>
        <tr style="border : 0.5px black solid">
            <th style="text-align:center">SL.No.</th>
            <th style="text-align:center">Student Name</th>
            <th style="text-align:center">Adm.No</th>
            <th style="text-align:center">Roll No</th>
            <th style="text-align:center">Class</th>
            <th style="text-align:center">Section</th>
            <th style="text-align:center">Total Working Days</th>
            <th style="text-align:center">Total Present Days</th>
            <th style="text-align:center">Percentage</th>
        </tr>
        <tr style="border : 0.5px black solid" ng-repeat="user in printdatatable | filter : searchValue">
            <td style="text-align:center">{{$index+1}}</td>
            <td style="text-align:left;padding-left:5px">{{ user.studentname}}</td>
            <td style="text-align:left;padding-left:5px">{{ user.AMST_AdmNo}}</td>
            <td style="text-align:center;">{{ user.rollno}}</td>
            <td style="text-align:left;padding-left:5px">{{ user.classname}}</td>
            <td style="text-align:left;padding-left:5px">{{ user.sectionname}}</td>
            <td style="text-align:center;">{{ user.totalworkingdays}}</td>
            <td style="text-align:center;">{{ user.totalpresentdays}}</td>
            <td style="text-align:center;">{{ user.percentage}}</td>
        </tr>
    </table>
</div>


<div id="myModalotp" class="modal fade" role="dialog">
    <div class="modal-dialog" style="width:50%;">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" ng-click="BindData()" data-dismiss="modal"><i class="fa fa-times text-white" aria-hidden="true"></i><!--&times;--></button>
                <h4 class="modal-title text-white">Attendance Percentage Report </h4>

            </div>
            <div class="modal-body">
                <div>
                    <center>
                        <div class="" ng-init="otptype='Appsts'">
                            <label class="checkbox-inline" ng-show="mobileotpshow">
                                <input type="radio" value="M" ng-model="otptype" ng-click="otponclickloaddata()" name="otp" required>
                                <span class="lbl padding-8"><b>Mobile OTP</b></span>
                            </label>
                            <label class="checkbox-inline" ng-show="emailotpshow">
                                <input type="radio" value="E" ng-model="otptype" ng-click="otponclickloaddata()" name="otp" required>
                                <span class="lbl padding-8"><b>Email OTP</b></span>
                            </label>
                        </div>
                        <div ng-show="otpmobile">

                            <p><h4 style="color:red;">OTP will be Send To Authorised Mobile No!!</h4></p>
                            <br />
                            <p><h4>Mobile Number: ******{{mobileno}}</h4></p>

                        </div>
                        <div ng-show="otpemail">

                            <p><h4 style="color:red;">OTP will be Send To Authorised Email Id!!</h4></p>
                            <br />
                            <p><h4>Email Id: <b class="text-lowercase">{{emailid | capitalize}}******</b></h4></p>

                        </div>
                    </center>
                    <br />
                    <div ng-show="buttonotp">
                        <center>
                            <button type="button" class="btn btn-primary" ng-click="sendotpsms(otptype)">SEND OTP</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal"> Close</button>
                        </center>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="myModalswal" class="modal fade" role="dialog">
    <div class="modal-dialog" style="width:80%;">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times text-white" aria-hidden="true"></i><!--&times;--></button>
                <h4 class="modal-title text-white">Attendance Percentage Report  </h4>
            </div>
            <div class="modal-body">

                <div ng-show="radioval=='Student'">
                    <center>
                        <p><h4 style="color:red;">Students List Which You Are Selected !!!</h4></p>
                    </center>
                    <center><p ng-if="snd_sms==true && snd_email!=true"><b>NOTE:SMS Will Trigger For The Same </b></p></center>
                    <center><p ng-if="snd_email==true && snd_sms!=true"><b>NOTE:Email Will Trigger For The Same </b></p></center>
                    <center><p ng-if="snd_email==true && snd_sms==true"><b>NOTE:SMS and Email Will Trigger For The Same </b></p></center>

                    <table class="table table-hover table-responsive table-bordered text-center">
                        <thead>
                            <tr>
                                <th><a href="" ng-click="sortBy('sno')">SL.No.</a></th>
                                <th><a href="" ng-click="sortBy('studentname')">Student Name</a></th>
                                <th><a href="" ng-click="sortBy('AMST_AdmNo')">Adm.No</a></th>
                                <th><a href="" ng-click="sortBy('rollno')">Roll No</a></th>
                                <th><a href="" ng-click="sortBy('classname')">Class</a></th>
                                <th><a href="" ng-click="sortBy('sectionname')">Section</a></th>
                                <th><a href="" ng-click="sortBy('totalworkingdays')">Total Working Days</a></th>
                                <th><a href="" ng-click="sortBy('totalpresentdays')">Total Present Days</a></th>
                                <th><a href="" ng-click="sortBy('percentage')">Percentage</a></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="user in clslst2" pagination-id="page3">
                                <td>{{$index+1}}</td>
                                <td class="text-left padding-left-5">{{ user.studentname}}</td>
                                <td class="text-left padding-left-5">{{ user.AMST_AdmNo}}</td>
                                <td class="text-center">{{ user.rollno}}</td>
                                <td class="text-left padding-left-5">{{ user.classname}}</td>
                                <td class="text-left padding-left-5">{{ user.sectionname}}</td>
                                <td class="text-center">{{ user.totalworkingdays}}</td>
                                <td class="text-center">{{ user.totalpresentdays}}</td>
                                <td class="text-center">{{ user.percentage}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <br />
                    <dir-pagination-controls max-size="5" pagination-id="page3"
                                             direction-links="true"
                                             boundary-links="true">
                    </dir-pagination-controls>
                </div>

                <hr />
                <div>
                    <div ng-show="otpcheck">
                        <label for="mobile" class="control-label col-sm-4" style="text-align:right"><b>Enter OTP :</b></label>
                        <div class="col-sm-3">
                            <input type="password" class="form-control" name="OTP Number" placeholder="ENTER OTP NUMBER" data-ng-model="forgetEmailOTP" ng-pattern="/^[0-9]+$/">
                        </div>

                        <button type="button" class="btn btn-primary btn-xs" ng-click="VerifyforgetEmailOtp(forgetEmailOTP)">
                            Submit
                        </button>
                        <button type="button" ng-show="resendotpbutton" class="btn btn-primary btn-xs" ng-click="sendotpsms(otptype)">                            
                            Resend OTP
                        </button>
                    </div>
                </div>
                <br />
                <div style="text-align:center">
                    <md-button type="button" ng-click="SendAttendanceSMS()" ng-disabled="otpcheck" ng-show="smsdata" class="md-raised md-primary" id="submit">
                        SEND
                    </md-button>                    
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
